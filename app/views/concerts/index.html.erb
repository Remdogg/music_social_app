
<div class="jumbotron">
    <h1>Bandtogether</h1>
</div>

<p id="notice"><%= notice %></p>

<h1>Upcoming Concerts</h1>
<form action="/concerts" method="get">
 <input type="text" name="search">
 <input type="submit" value="Search" >
</form>

<table class="table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Start</th>
      <th>End</th>
      <th>Artist</th>
      <th>City</th>
      <th>State</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @concerts.each do |concert| %>
      <tr>
        <td><a href = 'concerts/<%=concert.id %>'><%= concert.title %></a></td>
        <td><%= concert.start %></td>
        <td><%= concert.end %></td>
        <td><%= concert.artist %></td>
        <td><%= concert.city %></td>
        <td><%= concert.state %></td>
        <% if !current_user.nil? %>
        <% if current_user.has_role? :admin %>
        <td><%= link_to 'Edit', edit_concert_path(concert) %></td>
        <td><%= link_to 'Destroy', concert, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>


<br>

<% if !current_user.nil? %>
<% if current_user.has_role? :admin %>
<%= link_to 'New Concert', new_concert_path %>
<% end %>
<% end %>

<div id="map">Google map will appear here...</div>
         <script type="text/javascript">
         handler = Gmaps.build('Google');
         handler.buildMap({
           provider: {},
           internal: {id: 'map'}
         },
         function() {
           markers = handler.addMarkers(<%=raw @pindrop.to_json %>);
           handler.bounds.extendWith(markers);
           handler.fitMapToBounds();
           handler.getMap().setZoom(8);
           if(navigator.geolocation)
           navigator.geolocation.getCurrentPosition(displayOnMap);

         }
       );
       function displayOnMap(position){
         var marker = handler.addMarker({
           lat: position.coords.latitude,
           lng: position.coords.longitude

         });
         var image = '<%= asset_path 'map-person.png' %>';
         marker.serviceObject.icon = image;
         handler.map.centerOn(marker);
       };
       </script>
